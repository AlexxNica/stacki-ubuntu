<stack:ubuntu>

	<stack:description>
	User setup for all nodes installed with Ubuntu.
	</stack:description>

	<stack:copyright>
	(c) 2006 - 2016 StackIQ Inc.
	All rights reserved. stacki(r) v3.0 www.stacki.com
	</stack:copyright>



<late_command cond="&ubuntu.serial; == False">
in-target /usr/bin/curl -s -k -o /target/dev/null/ https://&Kickstart_PrivateAddress;/install/sbin/public/setPxeboot.cgi?params='\{"action":"os"\}';
in-target sed -i 's/PermitRootLogin.*/PermitRootLogin yes/g' /etc/ssh/sshd_config;
in-target sed -i 's/#AuthorizedKeysFile.*/AuthorizedKeysFile %h\/\.ssh\/authorized_keys/g' /etc/ssh/sshd_config;
/bin/mkdir -p /target/root/.ssh;
/bin/echo -ne "<stack:eval shell="sh">awk 'NR > 1 { print prev } { prev=$0 } END { ORS=""; print }' /root/.ssh/id_rsa.pub</stack:eval>" &gt;&gt; /target/root/.ssh/authorized_keys;
</late_command>

<late_command cond="&ubuntu.serial; == True">
in-target /usr/bin/curl -s -k -o /target/dev/null/ https://&Kickstart_PrivateAddress;/install/sbin/public/setPxeboot.cgi?params='\{"action":"os"\}';
in-target sed -i 's/PermitRootLogin.*/PermitRootLogin yes/g' /etc/ssh/sshd_config;
in-target sed -i 's/#AuthorizedKeysFile.*/AuthorizedKeysFile %h\/\.ssh\/authorized_keys/g' /etc/ssh/sshd_config;
/bin/mkdir -p /target/root/.ssh;
/bin/echo -ne "<stack:eval shell="sh">awk 'NR > 1 { print prev } { prev=$0 } END { ORS=""; print }' /root/.ssh/id_rsa.pub</stack:eval>" &gt;&gt; /target/root/.ssh/authorized_keys;
;
</late_command>

</stack:ubuntu> 
